version: '3.8'

services:
    ### APP (php-fpm) ##############################################
    app:
        build:
            context: ./docker/app
        volumes:
            - ./docker/app/php.ini:/usr/local/etc/php/php.ini
            - ./docker/app/supervisor-logs:/var/log
            - .:/var/www/html:delegated
        expose:
            - "9000"
        networks:
            - "mynetwork"

    ### DB (MariaDB) ##############################################
    db:
        build:
            context: ./docker/mariadb
        volumes:
            - db-data:/var/lib/mysql
            - ./docker/mariadb/docker-entrypoint-initdb.d:/docker-entrypoint-initdb.d
        environment:
            - MYSQL_ALLOW_EMPTY_PASSWORD=yes
            - MYSQL_DATABASE=my_models
        ports:
            - "3306:3306"
        networks:
            - "mynetwork"

networks:
    mynetwork:
        driver: "bridge"

volumes:
    db-data:
